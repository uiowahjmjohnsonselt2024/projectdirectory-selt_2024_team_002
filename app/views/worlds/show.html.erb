<!DOCTYPE html>
<html lang="en-US">
<head>
  <title>Worlds</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
  <div class="modal">
    <svg class="x" fill="#000000" height="20px" width="20px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 460.775 460.775" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M285.08,230.397L456.218,59.27c6.076-6.077,6.076-15.911,0-21.986L423.511,4.565c-2.913-2.911-6.866-4.55-10.992-4.55 c-4.127,0-8.08,1.639-10.993,4.55l-171.138,171.14L59.25,4.565c-2.913-2.911-6.866-4.55-10.993-4.55 c-4.126,0-8.08,1.639-10.992,4.55L4.558,37.284c-6.077,6.075-6.077,15.909,0,21.986l171.138,171.128L4.575,401.505 c-6.074,6.077-6.074,15.911,0,21.986l32.709,32.719c2.911,2.911,6.865,4.55,10.992,4.55c4.127,0,8.08-1.639,10.994-4.55 l171.117-171.12l171.118,171.12c2.913,2.911,6.866,4.55,10.993,4.55c4.128,0,8.081-1.639,10.992-4.55l32.709-32.719 c6.074-6.075,6.074-15.909,0-21.986L285.08,230.397z"></path> </g></svg>
    <%= image_tag("logo.png", width: 200) %>

    <h2></h2>
  </div>
<div>
  <div class="game_toolbar">
    <%= button_to 'Back to Worlds', worlds_leave_world_path(id: @world.id), method: :post, id: "leave_world_button", class: "secondary_button"%>
    <span class="world_name">World Name: <%= @world[:world_name] %></span>
    <span class="world_id">World ID: <%= @world[:world_code] %></span>
  </div>


<script>
  var worldId = <%= @world.id %>;
</script>

<div class="grid_container">
  <% (1..World.dim).each do |row| %>
    <% (1..World.dim).each do |col| %>
      <% if @data[row][col].image.attached? %>
          <div class="grid_cell filled_cell" >
            <%= image_tag(url_for(@data[row][col].image), class: "grid_image") %>
            <div class="hidden"><%=row%>-<%=col%></div>
          </div>
        <% else %>
          <div class="grid_cell filled_cell">
            <svg class="question" fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 93.936 93.936" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M80.179,13.758c-18.342-18.342-48.08-18.342-66.422,0c-18.342,18.341-18.342,48.08,0,66.421 c18.342,18.342,48.08,18.342,66.422,0C98.521,61.837,98.521,32.099,80.179,13.758z M44.144,83.117 c-4.057,0-7.001-3.071-7.001-7.305c0-4.291,2.987-7.404,7.102-7.404c4.123,0,7.001,3.044,7.001,7.404 C51.246,80.113,48.326,83.117,44.144,83.117z M54.73,44.921c-4.15,4.905-5.796,9.117-5.503,14.088l0.097,2.495 c0.011,0.062,0.017,0.125,0.017,0.188c0,0.58-0.47,1.051-1.05,1.051c-0.004-0.001-0.008-0.001-0.012,0h-7.867 c-0.549,0-1.005-0.423-1.047-0.97l-0.202-2.623c-0.676-6.082,1.508-12.218,6.494-18.202c4.319-5.087,6.816-8.865,6.816-13.145 c0-4.829-3.036-7.536-8.548-7.624c-3.403,0-7.242,1.171-9.534,2.913c-0.264,0.201-0.607,0.264-0.925,0.173 s-0.575-0.327-0.693-0.636l-2.42-6.354c-0.169-0.442-0.02-0.943,0.364-1.224c3.538-2.573,9.441-4.235,15.041-4.235 c12.36,0,17.894,7.975,17.894,15.877C63.652,33.765,59.785,38.919,54.73,44.921z"></path> </g> </g></svg>
            <div class="hidden"><%=row%>-<%=col%></div>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="game-ui">
    <%= form_tag "/worlds/game/cell_quest", method: :post, id: 'quest_form' do %>
      <input type="hidden" name="world_id" id="world_id" value="<%= @world.id %>"/>
      <%= button_to 'Quest', "", method: :post, id: "quest_log_button", class: "game_button"%>
    <% end %>
    <%= form_tag "/worlds/game/cell_action", method: :post, id: 'action_form' do %>
      <input type="hidden" name="world_id" id="world_id" value="<%= @world.id %>"/>
      <%= button_to 'Action', "", method: :post, id: "action_engage_button", class: "game_button"%>
    <% end %>
    <%= form_tag "/worlds/game/cell_shop", method: :post, id: 'shop_form' do %>
      <input type="hidden" name="world_id" id="world_id" value="<%= @world.id %>"/>
      <%= button_to 'Shop', "", method: :post, id: "shop_log_button", class: "game_button"%>
    <% end %>
  </div>

  <div class="scroll-independent-div-cl">
    <div class="floating-blob">
      <p>Level 1</p>
      <p>Cell (<%=@pos_row%>, <%=@pos_col%>)</p>
    </div>
  </div>
  <div class="scroll-independent-div-cr">
    <div class="floating-blob">
      <p id="xp-text"></p>
      <div class="xp-bar-container">
        <div class="xp-bar" id="xp-bar">

        </div>
      </div>
    </div>
  </div>
</div>

<script>
    const currentXP = <%= @user_world[:xp] %>;
    const maxXP = 100; // Maximum XP
    const xpBar = document.getElementById('xp-bar');
    const xpText = document.getElementById('xp-text');

    // Set the width of the XP bar
    xpBar.style.width = `${(currentXP / maxXP) * 100}%`;

    // Update the XP text
    xpText.textContent = `XP: ${currentXP}/${maxXP}`;
</script>

</body>
</html>